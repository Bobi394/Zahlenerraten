<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Admin Bereich âš™ï¸</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial;
  background: #111827;
  color: #f1f5f9;
  padding: 30px;
}
h1 {
  color: #38bdf8;
  text-align: center;
}
section {
  background: #1e293b;
  padding: 15px;
  margin: 20px auto;
  border-radius: 10px;
  max-width: 500px;
}
input, button, label {
  display: block;
  margin: 8px auto;
  padding: 8px;
  font-size: 16px;
  border-radius: 6px;
  border: none;
}
input[type=checkbox] { display: inline; width: auto; margin-left: 10px; }
button {
  background-color: #3b82f6;
  color: white;
  cursor: pointer;
}
button:hover { background-color: #2563eb; }
hr { border: 0.5px solid #334155; margin: 15px 0; }
#requests { margin-top: 15px; }
.requestBox {
  background: #334155;
  padding: 8px;
  border-radius: 6px;
  margin-bottom: 8px;
}
</style>
</head>
<body>
<h1>âš™ï¸ Admin Bereich</h1>

<section>
  <h2>ğŸ”¢ Spieleinstellungen</h2>
  <label>Minimale Zahl: <input type="number" id="minNumber" value="1"></label>
  <label>Maximale Zahl: <input type="number" id="maxNumber" value="50"></label>
  <label>Feste Zahl (wenn Zufall aus): <input type="number" id="fixedNumber" value="10"></label>
  <label>Max. Versuche: <input type="number" id="maxAttempts" value="5"></label>
  <label><input type="checkbox" id="randomNumber"> Zufallszahl aktivieren</label>
  <label>ğŸ”— Link / Passwort-Seite: <input type="text" id="linkURL" placeholder="https://..."></label>
  <button id="saveSettings">ğŸ’¾ Speichern</button>
</section>

<section>
  <h2>ğŸ”„ Steuerung</h2>
  <button id="reloadAll">ğŸ”ƒ Alle Spielerseiten neu laden</button>
  <p id="lastReloadText">Letzter Reload: -</p>
</section>

<section>
  <h2>ğŸ“¬ Anfragen verwalten</h2>
  <div id="requests">Lade Anfragen...</div>
</section>

<script type="module">
const firebaseConfig = {
  apiKey: "AIzaSyBSDffrKz3_AE_iuwOLuZNB0yWLStMysSI",
  authDomain: "zahlenerraten.firebaseapp.com",
  databaseURL: "https://zahlenerraten-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "zahlenerraten",
  storageBucket: "zahlenerraten.firebasestorage.app",
  messagingSenderId: "143969932071",
  appId: "1:143969932071:web:850baabab3f9c0f2de0f02",
  measurementId: "G-KP89LYZJMT"
};

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, set, get, onValue, remove, update } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Elemente
const minNumber = document.getElementById("minNumber");
const maxNumber = document.getElementById("maxNumber");
const fixedNumber = document.getElementById("fixedNumber");
const maxAttempts = document.getElementById("maxAttempts");
const randomNumber = document.getElementById("randomNumber");
const linkURL = document.getElementById("linkURL");
const saveSettingsBtn = document.getElementById("saveSettings");
const reloadBtn = document.getElementById("reloadAll");
const lastReloadText = document.getElementById("lastReloadText");
const requestsDiv = document.getElementById("requests");

// ğŸ”¹ Einstellungen laden
async function loadSettings() {
  const snap = await get(ref(db, "settings"));
  if (snap.exists()) {
    const s = snap.val();
    minNumber.value = s.minNumber;
    maxNumber.value = s.maxNumber;
    fixedNumber.value = s.fixedNumber;
    maxAttempts.value = s.maxAttempts;
    randomNumber.checked = s.randomNumber;
    linkURL.value = s.linkURL || "";
  }
}
loadSettings();

// ğŸ”¹ Einstellungen speichern
saveSettingsBtn.onclick = async () => {
  await set(ref(db, "settings"), {
    minNumber: Number(minNumber.value),
    maxNumber: Number(maxNumber.value),
    fixedNumber: Number(fixedNumber.value),
    maxAttempts: Number(maxAttempts.value),
    randomNumber: randomNumber.checked,
    linkURL: linkURL.value
  });
  alert("âœ… Einstellungen gespeichert!");
};

// ğŸ”¹ Reload fÃ¼r alle Spielerseiten
reloadBtn.onclick = async () => {
  const newTime = Date.now().toString();
  await set(ref(db, "reloadFlag/time"), newTime);
  lastReloadText.textContent = "Letzter Reload: " + new Date().toLocaleTimeString();
};

// ğŸ”¹ Letzten Reload anzeigen
onValue(ref(db, "reloadFlag/time"), (snap) => {
  if (snap.exists()) {
    const time = new Date(Number(snap.val())).toLocaleTimeString();
    lastReloadText.textContent = "Letzter Reload: " + time;
  }
});

// ğŸ”¹ Anfragen laden & anzeigen
onValue(ref(db, "requests"), (snap) => {
  requestsDiv.innerHTML = "";
  if (!snap.exists()) {
    requestsDiv.textContent = "Keine offenen Anfragen.";
    return;
  }

  const data = snap.val();
  let count = 0;
  for (const [id, req] of Object.entries(data)) {
    if (req.status === "offen") {
      count++;
      const box = document.createElement("div");
      box.className = "requestBox";
      box.innerHTML = `
        <p>ğŸ‘¤ ${req.name}</p>
        <button class="acceptBtn">âœ… Akzeptieren</button>
        <button class="declineBtn">âŒ Ablehnen</button>
      `;

      box.querySelector(".acceptBtn").onclick = () => {
        update(ref(db, "requests/" + id), { status: "akzeptiert" });
      };

      box.querySelector(".declineBtn").onclick = () => {
        update(ref(db, "requests/" + id), { status: "abgelehnt" });
      };

      requestsDiv.appendChild(box);
    }
  }

  if (count === 0) requestsDiv.textContent = "Keine offenen Anfragen.";
});
</script>
</body>
</html>