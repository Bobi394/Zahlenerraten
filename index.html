<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Zahlen-RÃ¤tsel ðŸ§©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; background: #0f172a; color: #fff; text-align: center; padding: 40px; }
h1 { color: #38bdf8; }
input, button { padding: 10px; margin: 8px; border-radius: 8px; border: none; font-size: 16px; }
input { width: 80px; text-align: center; }
button { background-color: #3b82f6; color: #fff; cursor: pointer; }
button:hover { background-color: #2563eb; }
#info, #hint, #result { margin-top: 15px; font-size: 18px; }
#langBtn { position: absolute; top: 10px; right: 15px; background: #1e293b; color: white; border-radius: 8px; }
</style>
</head>
<body>

<button id="langBtn">ðŸ‡©ðŸ‡ª Deutsch</button>
<h1 id="title">ðŸ”¢ Zahlen erraten</h1>
<p id="rangeText">Lade Einstellungen...</p>
<input type="number" id="guess" placeholder="Zahl">
<button id="guessBtn">Raten</button>
<p id="hint"></p>
<p id="info"></p>
<p id="result"></p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

document.addEventListener("DOMContentLoaded", () => {

const firebaseConfig = {
  apiKey: "AIzaSyBSDffrKz3_AE_iuwOLuZNB0yWLStMysSI",
  authDomain: "zahlenerraten.firebaseapp.com",
  databaseURL: "https://zahlenerraten-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "zahlenerraten",
  storageBucket: "zahlenerraten.firebasestorage.app",
  messagingSenderId: "143969932071",
  appId: "1:143969932071:web:850baabab3f9c0f2de0f02"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// HTML-Elemente
const guessInput = document.getElementById("guess");
const guessBtn = document.getElementById("guessBtn");
const info = document.getElementById("info");
const hint = document.getElementById("hint");
const result = document.getElementById("result");
const rangeText = document.getElementById("rangeText");
const title = document.getElementById("title");
const langBtn = document.getElementById("langBtn");

let lang = "de";
let settings = {};
let currentNumber = 0;
let attemptsLeft = 0;

// Texte
const texts = {
  de: {
    title: "ðŸ”¢ Zahlen erraten",
    placeholder: "Zahl",
    guessBtn: "Raten",
    loading: "Lade Einstellungen...",
    range: (min,max) => `Errate die Zahl zwischen ${min} und ${max}`,
    tooHigh: "ðŸ“‰ Zu hoch!",
    tooLow: "ðŸ“ˆ Zu niedrig!",
    wrong: "âŒ Falsch! Versuch es nochmal!",
    correct: "ðŸŽ‰ Richtig! Du wirst weitergeleitet...",
    noTries: (num) => `âŒ Keine Versuche mehr! Die richtige Zahl war ${num}.`,
    triesLeft: (num) => `Noch ${num} Versuche.`,
    invalid: "âš ï¸ Bitte gib eine gÃ¼ltige Zahl ein!"
  },
  en: {
    title: "ðŸ”¢ Guess the Number",
    placeholder: "Number",
    guessBtn: "Guess",
    loading: "Loading settings...",
    range: (min,max) => `Guess the number between ${min} and ${max}`,
    tooHigh: "ðŸ“‰ Too high!",
    tooLow: "ðŸ“ˆ Too low!",
    wrong: "âŒ Wrong! Try again!",
    correct: "ðŸŽ‰ Correct! Redirecting...",
    noTries: (num) => `âŒ No tries left! The correct number was ${num}.`,
    triesLeft: (num) => `${num} tries left.`,
    invalid: "âš ï¸ Please enter a valid number!"
  }
};

// Sprachumschalter
langBtn.onclick = () => {
  lang = lang === "de" ? "en" : "de";
  langBtn.textContent = lang === "de" ? "ðŸ‡©ðŸ‡ª Deutsch" : "ðŸ‡¬ðŸ‡§ English";
  applyLanguage();
};

function applyLanguage(){
  title.textContent = texts[lang].title;
  guessInput.placeholder = texts[lang].placeholder;
  guessBtn.textContent = texts[lang].guessBtn;
  if(settings.minNumber) rangeText.textContent = texts[lang].range(settings.minNumber, settings.maxNumber);
  else rangeText.textContent = texts[lang].loading;
}

// Einstellungen laden
async function loadSettings(){
  const snapshot = await get(ref(db, "settings"));
  if(snapshot.exists()){
    settings = snapshot.val();
    applyLanguage();
    resetGame();
  } else rangeText.textContent = texts[lang].loading;
}

// Neue Runde
function resetGame(){
  const min = settings.minNumber || 1;
  const max = settings.maxNumber || 50;
  const isRandom = settings.randomNumber;
  currentNumber = isRandom ? Math.floor(Math.random()*(max-min+1))+min : Number(settings.fixedNumber)||10;
  attemptsLeft = settings.maxAttempts||5;
  info.textContent = texts[lang].triesLeft(attemptsLeft);
  hint.textContent = "";
  result.textContent = "";
  guessInput.disabled=false; guessBtn.disabled=false;
}

// Rateversuch
guessBtn.onclick = () => {
  const guess = Number(guessInput.value);
  if(!guess){ hint.textContent=texts[lang].invalid; return; }
  attemptsLeft--;
  const isRandom=settings.randomNumber;
  if(guess===currentNumber){
    result.textContent=texts[lang].correct;
    setTimeout(()=>window.location.href="anfrage.html",1000);
    guessInput.disabled=true; guessBtn.disabled=true;
    return;
  }
  if(attemptsLeft<=0){
    result.textContent=texts[lang].noTries(currentNumber);
    guessInput.disabled=true; guessBtn.disabled=true;
    return;
  }
  hint.textContent=isRandom?texts[lang].wrong:(guess>currentNumber?texts[lang].tooHigh:texts[lang].tooLow);
  info.textContent=texts[lang].triesLeft(attemptsLeft);
  if(isRandom){
    const min=settings.minNumber||1;
    const max=settings.maxNumber||50;
    currentNumber=Math.floor(Math.random()*(max-min+1))+min;
  }
}

// Reload Listener
const reloadRef = ref(db, "reloadFlag/time");
let firstLoad=true;
onValue(reloadRef,(snap)=>{
  if(!snap.exists()) return;
  const newTime=snap.val();
  const lastReload=localStorage.getItem("lastReloadTime");
  if(firstLoad){ firstLoad=false; localStorage.setItem("lastReloadTime",newTime); return; }
  if(newTime && newTime!==lastReload){ localStorage.setItem("lastReloadTime",newTime); location.reload(); }
});

loadSettings();

});
</script>
</body>
</html>