<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Hotspot Ratespiel ğŸ¦</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; background:#101820; color:#fff; text-align:center; padding:40px; }
    input,button { padding:10px; border-radius:8px; margin:5px; width:200px; }
    .box { background:#1e293b; display:inline-block; padding:30px; border-radius:12px; }
    .secret { font-family: monospace; background:#000; padding:6px; border-radius:8px; }
  </style>
</head>
<body>
  <div class="box">
    <h1>ğŸ”¥ Hotspot Zahlenspiel ğŸ”¥</h1>
    <p id="rangeInfo">Lade Bereichâ€¦</p>

    <p id="info">Lade Einstellungenâ€¦</p>
    <input id="guessInput" type="number" placeholder="Zahl eingeben">
    <button id="guessBtn">Raten</button>

    <p id="result"></p>
    <div id="passwordBox" style="display:none; margin-top:15px;">
      ğŸ‰ Dein Hotspot-Passwort: <span class="secret" id="pw"></span>
    </div>
  </div>

  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyBSDffrKz3_AE_iuwOLuZNB0yWLStMysSI",
      authDomain: "zahlenerraten.firebaseapp.com",
      databaseURL: "https://zahlenerraten-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "zahlenerraten",
      storageBucket: "zahlenerraten.firebasestorage.app",
      messagingSenderId: "143969932071",
      appId: "1:143969932071:web:850baabab3f9c0f2de0f02",
      measurementId: "G-KP89LYZJMT"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, get, child, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const rangeInfo = document.getElementById("rangeInfo");
    const info = document.getElementById("info");
    const guessInput = document.getElementById("guessInput");
    const guessBtn = document.getElementById("guessBtn");
    const result = document.getElementById("result");
    const passwordBox = document.getElementById("passwordBox");
    const pw = document.getElementById("pw");

    let randomNumber = 1;
    let attemptsLeft = 0;
    let password = "";
    let lastReload = 0;
    let randomNumberMode = true;
    let minNumber = 1;
    let maxNumber = 50;

    // ğŸ”¹ Einstellungen laden
    async function loadSettings() {
      const snapshot = await get(child(ref(db), "settings"));
      if(snapshot.exists()){
        const data = snapshot.val();
        attemptsLeft = data.maxAttempts || 6;
        password = data.password || "";
        randomNumberMode = data.randomNumber ?? true;
        minNumber = data.minNumber || 1;
        maxNumber = data.maxNumber || 50;

        // Initialzahl
        if(randomNumberMode){
          randomNumber = Math.floor(Math.random() * (maxNumber - minNumber + 1)) + minNumber;
        } else {
          randomNumber = data.fixedNumber || 1;
        }

        info.textContent = `Du hast ${attemptsLeft} Versuche! ğŸ˜`;
        rangeInfo.textContent = `Errate eine Zahl zwischen ${minNumber} und ${maxNumber}`;
      } else {
        info.textContent = "âš ï¸ Einstellungen nicht gefunden.";
        rangeInfo.textContent = "";
      }
    }

    await loadSettings();

    // ğŸ”¹ Tipp-Button
    guessBtn.onclick = () => {
      const guess = Number(guessInput.value);
      if(!guess || guess < minNumber || guess > maxNumber){
        result.textContent = `âš ï¸ Gib eine Zahl zwischen ${minNumber} und ${maxNumber} ein!`;
        return;
      }

      // Zufallszahl bei jedem Versuch neu generieren, falls aktiviert
      if(randomNumberMode){
        randomNumber = Math.floor(Math.random() * (maxNumber - minNumber + 1)) + minNumber;
      }

      attemptsLeft--;

      if(guess === randomNumber){
        result.textContent = "âœ… Richtig geraten!";
        pw.textContent = password;
        passwordBox.style.display = "block";
        guessBtn.disabled = true;
        guessInput.disabled = true;
      } else if(attemptsLeft <= 0){
        result.textContent = `âŒ Keine Versuche mehr! Die Zahl war ${randomNumber}.`;
        guessBtn.disabled = true;
        guessInput.disabled = true;
      } else {
        result.textContent = guess > randomNumber ? "ğŸ“‰ Zu hoch!" : "ğŸ“ˆ Zu niedrig!";
        info.textContent = `Noch ${attemptsLeft} Versuche`;
      }
    };

    // ğŸ”¹ Admin Reload Trigger Ã¼berwachen
    const reloadRef = ref(db, "reloadTrigger");
    const snapshot = await get(reloadRef);
    if(snapshot.exists()) lastReload = snapshot.val();

    onValue(reloadRef, (snapshot) => {
      if(snapshot.exists()){
        const reloadValue = snapshot.val();
        if(reloadValue !== lastReload){
          lastReload = reloadValue;
          location.reload();
        }
      }
    });
  </script>
</body>
</html>