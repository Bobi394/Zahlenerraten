<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Admin-Bereich ğŸ¦</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; background: #0f172a; color: #fff; text-align: center; padding: 30px; }
h1 { color: #38bdf8; }
section { background: #1e293b; padding: 20px; border-radius: 10px; margin: 20px auto; width: 90%; max-width: 500px; text-align: left; }
label { display: block; margin-top: 10px; font-weight: bold; }
input, select, button { margin-top: 5px; width: 100%; padding: 8px; border-radius: 8px; border: none; font-size: 15px; }
button { background-color: #3b82f6; color: white; cursor: pointer; margin-top: 10px; }
button:hover { background-color: #2563eb; }
.requestItem { border-bottom: 1px solid #334155; padding: 8px 0; }
.requestItem:last-child { border-bottom: none; }
.requestActions button { width: auto; margin-right: 5px; padding: 6px 10px; font-size: 13px; }
</style>
</head>
<body>
<h1>ğŸ¦ Admin-Bereich</h1>

<section>
  <h2>âš™ï¸ Einstellungen</h2>
  <label>Minimale Zahl:</label>
  <input type="number" id="minNumber" value="1">

  <label>Maximale Zahl:</label>
  <input type="number" id="maxNumber" value="50">

  <label>Maximale Versuche:</label>
  <input type="number" id="maxAttempts" value="6">

  <label>Zufallszahl aktivieren?</label>
  <select id="randomNumber">
    <option value="true">Ja</option>
    <option value="false">Nein</option>
  </select>

  <label>Feste Zahl (wenn Zufall aus):</label>
  <input type="number" id="fixedNumber" value="10">

  <label>Link zur Passwort-Seite (fÃ¼r akzeptierte Anfragen):</label>
  <input type="text" id="linkURL" placeholder="https://...">

  <button id="saveBtn">ğŸ’¾ Einstellungen speichern</button>
  <button id="reloadBtn">ğŸ”„ Alle Spieler neu laden</button>
</section>

<section>
  <h2>ğŸ“¨ Spieler-Anfragen</h2>
  <div id="requests">Lade Anfragen...</div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, set, get, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBSDffrKz3_AE_iuwOLuZNB0yWLStMysSI",
  authDomain: "zahlenerraten.firebaseapp.com",
  databaseURL: "https://zahlenerraten-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "zahlenerraten",
  storageBucket: "zahlenerraten.firebasestorage.app",
  messagingSenderId: "143969932071",
  appId: "1:143969932071:web:850baabab3f9c0f2de0f02"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const saveBtn = document.getElementById("saveBtn");
const reloadBtn = document.getElementById("reloadBtn");
const requestsDiv = document.getElementById("requests");

// ğŸ”¹ Einstellungen laden
async function loadSettings() {
  const snapshot = await get(ref(db, "settings"));
  if (snapshot.exists()) {
    const s = snapshot.val();
    document.getElementById("minNumber").value = s.minNumber ?? 1;
    document.getElementById("maxNumber").value = s.maxNumber ?? 50;
    document.getElementById("maxAttempts").value = s.maxAttempts ?? 6;
    document.getElementById("randomNumber").value = s.randomNumber ? "true" : "false";
    document.getElementById("fixedNumber").value = s.fixedNumber ?? 10;
    document.getElementById("linkURL").value = s.linkURL ?? "";
  }
}
await loadSettings();

// ğŸ”¹ Einstellungen speichern
saveBtn.onclick = async () => {
  await set(ref(db, "settings"), {
    minNumber: Number(document.getElementById("minNumber").value),
    maxNumber: Number(document.getElementById("maxNumber").value),
    maxAttempts: Number(document.getElementById("maxAttempts").value),
    randomNumber: document.getElementById("randomNumber").value === "true",
    fixedNumber: Number(document.getElementById("fixedNumber").value),
    linkURL: document.getElementById("linkURL").value
  });
  alert("âœ… Einstellungen gespeichert!");
};

// ğŸ”¹ Reload Button
reloadBtn.onclick = async () => {
  const reloadRef = ref(db, "reloadFlag/time");
  await set(reloadRef, Date.now());
  alert("ğŸ”„ Spieler-Seiten werden neu geladen!");
};

// ğŸ”¹ Anfragen live anzeigen
const requestsRef = ref(db, "requests");
onValue(requestsRef, (snapshot) => {
  if (!snapshot.exists()) {
    requestsDiv.textContent = "Keine Anfragen vorhanden.";
    return;
  }

  const data = snapshot.val();
  requestsDiv.innerHTML = "";

  for (const [key, req] of Object.entries(data)) {
    if (req.status && req.status !== "offen") continue;

    const div = document.createElement("div");
    div.classList.add("requestItem");
    div.innerHTML = `
      <b>ğŸ§ Name:</b> ${req.name || "Unbekannt"}<br>
      <b>ğŸ“… Gesendet:</b> ${req.time ? new Date(req.time).toLocaleString() : "Unbekannt"}<br>
      <div class="requestActions">
        <button data-key="${key}" data-action="accept">âœ… Akzeptieren</button>
        <button data-key="${key}" data-action="deny">âŒ Ablehnen</button>
      </div>
    `;
    requestsDiv.appendChild(div);
  }

  // Klick-Events
  document.querySelectorAll("[data-key]").forEach(btn => {
    btn.onclick = async () => {
      const key = btn.getAttribute("data-key");
      const action = btn.getAttribute("data-action");
      const newStatus = action === "accept" ? "akzeptiert" : "abgelehnt";
      await update(ref(db, `requests/${key}`), { status: newStatus });
      setTimeout(() => remove(ref(db, `requests/${key}`)), 1000);
    };
  });
});
</script>
</body>
</html>