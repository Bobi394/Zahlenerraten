<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Zahlen-RÃ¤tsel ðŸ§©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial;
  background: #0f172a;
  color: #fff;
  text-align: center;
  padding: 40px;
}
h1 { color: #38bdf8; }

input, button {
  padding: 10px;
  margin: 8px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}
input { width: 80px; text-align: center; }
button {
  background-color: #3b82f6;
  color: #fff;
  cursor: pointer;
}
button:hover { background-color: #2563eb; }

#info, #hint, #result {
  margin-top: 15px;
  font-size: 18px;
}
</style>
</head>
<body>
<h1>ðŸ”¢ Zahlen erraten</h1>
<p id="rangeText">Lade Einstellungen...</p>
<input type="number" id="guess" placeholder="Zahl">
<button id="guessBtn">Raten</button>
<p id="hint"></p>
<p id="info"></p>
<p id="result"></p>

<script type="module">
const firebaseConfig = {
  apiKey: "AIzaSyBSDffrKz3_AE_iuwOLuZNB0yWLStMysSI",
  authDomain: "zahlenerraten.firebaseapp.com",
  databaseURL: "https://zahlenerraten-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "zahlenerraten",
  storageBucket: "zahlenerraten.firebasestorage.app",
  messagingSenderId: "143969932071",
  appId: "1:143969932071:web:850baabab3f9c0f2de0f02",
  measurementId: "G-KP89LYZJMT"
};

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const guessInput = document.getElementById("guess");
const guessBtn = document.getElementById("guessBtn");
const info = document.getElementById("info");
const hint = document.getElementById("hint");
const result = document.getElementById("result");
const rangeText = document.getElementById("rangeText");

let settings = {};
let currentNumber = 0;
let attemptsLeft = 0;

// ðŸ”¹ Einstellungen laden
async function loadSettings() {
  const snapshot = await get(ref(db, "settings"));
  if (snapshot.exists()) {
    settings = snapshot.val();
    rangeText.textContent = `Errate die Zahl zwischen ${settings.minNumber} und ${settings.maxNumber}`;
    resetGame();
  } else {
    rangeText.textContent = "Fehler beim Laden der Einstellungen!";
  }
}

// ðŸ”¹ Neue Zahl starten
function resetGame() {
  const min = settings.minNumber || 1;
  const max = settings.maxNumber || 50;
  const isRandom = settings.randomNumber;
  currentNumber = isRandom
    ? Math.floor(Math.random() * (max - min + 1)) + min
    : Number(settings.fixedNumber) || 10;
  attemptsLeft = settings.maxAttempts || 5;
  info.textContent = `Du hast ${attemptsLeft} Versuche.`;
  hint.textContent = "";
  result.textContent = "";
  guessInput.disabled = false;
  guessBtn.disabled = false;
}

// ðŸ”¹ Rateversuch
guessBtn.onclick = () => {
  const guess = Number(guessInput.value);
  if (!guess) {
    hint.textContent = "âš ï¸ Bitte gib eine gÃ¼ltige Zahl ein!";
    return;
  }

  attemptsLeft--;
  if (guess === currentNumber) {
    result.textContent = "ðŸŽ‰ Richtig! Du wirst weitergeleitet...";
    setTimeout(() => {
      window.location.href = "anfrage.html"; // Weiter zur Anfrage-Seite
    }, 1000);
    guessInput.disabled = true;
    guessBtn.disabled = true;
    return;
  }

  if (attemptsLeft <= 0) {
    result.textContent = `âŒ Keine Versuche mehr! Die richtige Zahl war ${currentNumber}.`;
    guessInput.disabled = true;
    guessBtn.disabled = true;
    return;
  }

  hint.textContent = guess > currentNumber ? "ðŸ“‰ Zu hoch!" : "ðŸ“ˆ Zu niedrig!";
  info.textContent = `Noch ${attemptsLeft} Versuche.`;
};

// ðŸ”¹ ðŸ”„ Admin-Reload-Listener (sicher, ohne Endlosschleife)
let lastReloadTime = 0;
const reloadRef = ref(db, "reloadFlag/time");

const reloadListener = onValue(reloadRef, (snap) => {
  if (!snap.exists()) return;
  const newTime = snap.val();
  if (newTime && newTime !== lastReloadTime) {
    lastReloadTime = newTime;
    console.log("ðŸ”„ Admin hat Reload ausgelÃ¶st!");
    // Listener abmelden, bevor reload
    reloadRef.off(); 
    location.reload();
  }
});

// Spiel starten
loadSettings();
</script>
</body>
</html>