<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Zahlen-RÃ¤tsel ğŸ§©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; background: #0f172a; color: #fff; text-align: center; padding: 40px; }
h1 { color: #38bdf8; }
input, button { padding: 10px; margin: 8px; border-radius: 8px; border: none; font-size: 16px; }
input { width: 80px; text-align: center; }
button { background-color: #3b82f6; color: #fff; cursor: pointer; }
button:hover { background-color: #2563eb; }
#info, #hint, #result { margin-top: 15px; font-size: 18px; }
</style>
</head>
<body>

<h1>Zahlen-RÃ¤tsel ğŸ§©</h1>
<p id="rangeText">Lade Einstellungenâ€¦</p>
<input type="number" id="guess" placeholder="Zahl">
<button id="guessBtn">Raten</button>
<p id="hint"></p>
<p id="info"></p>
<p id="result"></p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBSDffrKz3_AE_iuwOLuZNB0yWLStMysSI",
  authDomain: "zahlenerraten.firebaseapp.com",
  databaseURL: "https://zahlenerraten-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "zahlenerraten",
  storageBucket: "zahlenerraten.firebasestorage.app",
  messagingSenderId: "143969932071",
  appId: "1:143969932071:web:850baabab3f9c0f2de0f02"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const rangeText = document.getElementById("rangeText");
const guessInput = document.getElementById("guess");
const guessBtn = document.getElementById("guessBtn");
const hint = document.getElementById("hint");
const info = document.getElementById("info");
const result = document.getElementById("result");

let settings = {};
let currentNumber = 0;
let attemptsLeft = 0;

// ğŸ”¹ Lade Einstellungen
async function loadSettings() {
  try {
    const snapshot = await get(ref(db, "settings"));
    console.log("Snapshot existiert?", snapshot.exists());
    console.log("Snapshot value:", snapshot.val());

    if(snapshot.exists()){
      settings = snapshot.val();
      rangeText.textContent = `Errate die Zahl zwischen ${settings.minNumber} und ${settings.maxNumber}`;
      startGame();
    } else {
      rangeText.textContent = "âŒ Einstellungen konnten nicht gefunden werden!";
    }
  } catch(e) {
    console.error("Fehler beim Laden der Einstellungen:", e);
    rangeText.textContent = "âŒ Fehler beim Laden der Einstellungen!";
  }
}

// ğŸ”¹ Starte das Spiel
function startGame() {
  const min = settings.minNumber || 1;
  const max = settings.maxNumber || 50;
  const isRandom = settings.randomNumber;
  currentNumber = isRandom ? Math.floor(Math.random()*(max-min+1))+min : Number(settings.fixedNumber) || 10;
  attemptsLeft = settings.maxAttempts || 5;
  info.textContent = `Noch ${attemptsLeft} Versuche`;
}

// ğŸ”¹ Rate-Button
guessBtn.onclick = () => {
  const guess = Number(guessInput.value);
  if(!guess){ hint.textContent = "âš ï¸ Bitte gib eine gÃ¼ltige Zahl ein!"; return; }

  attemptsLeft--;
  info.textContent = `Noch ${attemptsLeft} Versuche`;

  if(guess === currentNumber){
    result.textContent = "ğŸ‰ Richtig!";
    guessInput.disabled = true;
    guessBtn.disabled = true;
    return;
  }

  if(attemptsLeft <= 0){
    result.textContent = `âŒ Keine Versuche mehr! Die Zahl war ${currentNumber}`;
    guessInput.disabled = true;
    guessBtn.disabled = true;
    return;
  }

  // Bei fester Zahl anzeigen ob zu hoch/zu niedrig
  if(!settings.randomNumber){
    result.textContent = guess > currentNumber ? "ğŸ“‰ Zu hoch!" : "ğŸ“ˆ Zu niedrig!";
  } else {
    result.textContent = "âŒ Falsch! Versuch es nochmal!";
  }

  // Neue Zahl wenn Zufall
  if(settings.randomNumber){
    currentNumber = Math.floor(Math.random()*(settings.maxNumber-settings.minNumber+1)) + settings.minNumber;
  }
}

// Start
loadSettings();
</script>
</body>
</html>