<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Hotspot Zahlenspiel ðŸ¦Ž</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial;
  background: #101820;
  color: #fff;
  text-align: center;
  padding: 40px;
}

.box {
  background: #1e293b;
  display: inline-block;
  padding: 30px;
  border-radius: 12px;
  width: 90%;
  max-width: 400px;
}

input, button {
  padding: 12px;
  margin: 8px 0;
  border-radius: 8px;
  border: none;
  width: 90%;
  max-width: 300px;
  font-size: 16px;
}

button {
  background-color: #3b82f6;
  color: #fff;
  cursor: pointer;
}

button:hover {
  background-color: #2563eb;
}

#reward {
  margin-top: 15px;
  font-weight: bold;
  color: #9ee7ff;
  word-break: break-all;
  user-select: all;
}

#result {
  margin-top: 15px;
  font-weight: bold;
}

#hint {
  margin-top: 10px;
  color: #9aa7b8;
}
</style>
</head>
<body>
<div class="box">
<h1>ðŸ”¥ Hotspot Zahlenspiel ðŸ”¥</h1>
<p id="rangeInfo">Lade Bereichâ€¦</p>
<p id="info">Lade Einstellungenâ€¦</p>

<input id="guessInput" type="number" placeholder="Zahl eingeben">
<button id="guessBtn">Raten</button>

<p id="result"></p>
<p id="hint"></p>
</div>

<script type="module">
const firebaseConfig = {
  apiKey: "AIzaSyBSDffrKz3_AE_iuwOLuZNB0yWLStMysSI",
  authDomain: "zahlenerraten.firebaseapp.com",
  databaseURL: "https://zahlenerraten-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "zahlenerraten",
  storageBucket: "zahlenerraten.firebasestorage.app",
  messagingSenderId: "143969932071",
  appId: "1:143969932071:web:850baabab3f9c0f2de0f02",
  measurementId: "G-KP89LYZJMT"
};

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const rangeInfo = document.getElementById("rangeInfo");
const info = document.getElementById("info");
const guessInput = document.getElementById("guessInput");
const guessBtn = document.getElementById("guessBtn");
const result = document.getElementById("result");
const hint = document.getElementById("hint");

let attemptsLeft = 0;
let randomNumberMode = true;
let minNumber = 1;
let maxNumber = 50;
let password = "";
let link = "";

async function loadSettings() {
  const snapshot = await get(child(ref(db), "settings"));
  if (snapshot.exists()) {
    const data = snapshot.val();
    attemptsLeft = data.maxAttempts || 6;
    randomNumberMode = data.randomNumber ?? true;
    minNumber = Number(data.minNumber) || 1;
    maxNumber = Number(data.maxNumber) || 50;
    password = data.password || "";
    link = data.link || "";
    info.textContent = `Du hast ${attemptsLeft} Versuche! ðŸ˜Ž`;
    rangeInfo.textContent = `Errate eine Zahl zwischen ${minNumber} und ${maxNumber}`;
  } else {
    info.textContent = "âš ï¸ Einstellungen nicht gefunden.";
    rangeInfo.textContent = "";
  }
}

await loadSettings();

guessBtn.onclick = async () => {
  const guess = Number(guessInput.value);
  if (!Number.isFinite(guess) || guess < minNumber || guess > maxNumber) {
    result.textContent = `âš ï¸ Gib eine Zahl zwischen ${minNumber} und ${maxNumber} ein!`;
    return;
  }

  let currentNumber;
  if (randomNumberMode) {
    currentNumber = Math.floor(Math.random() * (maxNumber - minNumber + 1)) + minNumber;
  } else {
    const fSnap = await get(child(ref(db, "settings/fixedNumber")));
    currentNumber = fSnap.exists() ? Number(fSnap.val()) : minNumber;
  }

  attemptsLeft--;

  if (guess === currentNumber) {
    result.textContent = "âœ… Richtig geraten!";
    guessBtn.disabled = true;
    guessInput.disabled = true;
    hint.textContent = "";

    // ðŸ”¹ Warte kurz, bevor weitergeleitet wird
    setTimeout(() => {
      window.location.href = "anfrage.html";
    }, 1500); // 1,5 Sekunden warten
    return;
  }

  if (attemptsLeft <= 0) {
    result.textContent = `âŒ Keine Versuche mehr! Letzte Zahl war ${currentNumber}.`;
    guessBtn.disabled = true;
    guessInput.disabled = true;
    hint.textContent = "";
    return;
  }

  hint.textContent = guess > currentNumber ? "ðŸ“‰ Zu hoch!" : "ðŸ“ˆ Zu niedrig!";
  info.textContent = `Noch ${attemptsLeft} Versuche`;
};
</script>
</body>
</html>