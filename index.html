<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zahlenraten ðŸŽ®</title>
<style>
body {
  background-color: #0f172a;
  color: white;
  font-family: Arial;
  text-align: center;
  padding: 40px;
}
h1 { color: #38bdf8; }
input, button {
  padding: 10px;
  margin: 8px;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}
input {
  width: 100px;
  text-align: center;
}
button {
  background-color: #3b82f6;
  color: white;
  cursor: pointer;
}
button:hover { background-color: #2563eb; }
#langBtn {
  position: absolute;
  top: 10px;
  right: 15px;
  background: #1e293b;
  color: white;
  border-radius: 8px;
}
</style>
</head>
<body>
<button id="langBtn">ðŸ‡©ðŸ‡ª Deutsch</button>
<h1 id="title">ðŸŽ® Roblox Zahlenraten</h1>
<p id="desc">Errate die geheime Zahl und erhalte eine Roblox-Belohnung!</p>
<p id="range">Bereich: 1â€“50</p>
<input type="number" id="guessInput" placeholder="Zahl">
<button id="guessBtn">Raten</button>
<p id="result"></p>

<script type="module">
const firebaseConfig = {
  apiKey: "AIzaSyBSDffrKz3_AE_iuwOLuZNB0yWLStMysSI",
  authDomain: "zahlenerraten.firebaseapp.com",
  databaseURL: "https://zahlenerraten-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "zahlenerraten",
  storageBucket: "zahlenerraten.firebasestorage.app",
  messagingSenderId: "143969932071",
  appId: "1:143969932071:web:850baabab3f9c0f2de0f02",
  measurementId: "G-KP89LYZJMT"
};

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const title = document.getElementById("title");
const desc = document.getElementById("desc");
const rangeText = document.getElementById("range");
const guessInput = document.getElementById("guessInput");
const guessBtn = document.getElementById("guessBtn");
const result = document.getElementById("result");
const langBtn = document.getElementById("langBtn");

let randomMode = true;
let min = 1, max = 50;
let attempts = 3;
let lang = "de";

// ðŸ”¹ Sprachtexte
const texts = {
  de: {
    title: "ðŸŽ® Roblox Zahlenraten",
    desc: "Errate die geheime Zahl und erhalte eine Roblox-Belohnung!",
    range: (a,b) => `Bereich: ${a}â€“${b}`,
    guess: "Raten",
    tooLow: "ðŸ”» Zu niedrig!",
    tooHigh: "ðŸ”º Zu hoch!",
    correct: "âœ… Richtig! Du wirst weitergeleitet...",
    attemptsLeft: (x) => `Du hast noch ${x} Versuche.`,
    lose: "âŒ Keine Versuche mehr! Versuch es spÃ¤ter erneut!",
    invalid: "âš ï¸ Bitte gib eine Zahl ein!"
  },
  en: {
    title: "ðŸŽ® Roblox Number Guessing",
    desc: "Guess the secret number to earn a Roblox reward!",
    range: (a,b) => `Range: ${a}â€“${b}`,
    guess: "Guess",
    tooLow: "ðŸ”» Too low!",
    tooHigh: "ðŸ”º Too high!",
    correct: "âœ… Correct! Redirecting...",
    attemptsLeft: (x) => `You have ${x} tries left.`,
    lose: "âŒ No tries left! Try again later!",
    invalid: "âš ï¸ Please enter a number!"
  }
};

// ðŸ—£ Sprachumschalter
langBtn.onclick = () => {
  lang = lang === "de" ? "en" : "de";
  langBtn.textContent = lang === "de" ? "ðŸ‡©ðŸ‡ª Deutsch" : "ðŸ‡¬ðŸ‡§ English";
  applyLang();
};

// Sprache anwenden
function applyLang() {
  title.textContent = texts[lang].title;
  desc.textContent = texts[lang].desc;
  rangeText.textContent = texts[lang].range(min, max);
  guessBtn.textContent = texts[lang].guess;
}

// ðŸ”¹ Daten von Admin laden
async function loadSettings() {
  const snap = await get(ref(db, "settings"));
  if (!snap.exists()) return;

  const data = snap.val();
  randomMode = data.randomMode ?? true;
  min = data.min ?? 1;
  max = data.max ?? 50;
  attempts = data.maxAttempts ?? 3;
  rangeText.textContent = texts[lang].range(min, max);
}

await loadSettings();
applyLang();

// ðŸ”¹ ZufÃ¤llige Zahl erzeugen
let secret = Math.floor(Math.random() * (max - min + 1)) + min;

// ðŸ”¹ Wenn Reload-Flag gesetzt wird â†’ Seite neu laden
let lastReloadTime = 0;
onValue(ref(db, "reloadFlag/time"), (snap) => {
  if (!snap.exists()) return;
  const time = snap.val();
  if (time !== lastReloadTime) {
    lastReloadTime = time;
    location.reload();
  }
});

// ðŸ”¹ Ratefunktion
guessBtn.onclick = () => {
  const guess = parseInt(guessInput.value);
  if (isNaN(guess)) {
    result.textContent = texts[lang].invalid;
    return;
  }

  attempts--;
  if (guess === secret) {
    result.textContent = texts[lang].correct;
    setTimeout(() => location.href = "anfrage.html", 1500);
  } else if (!randomMode) {
    if (guess < secret) result.textContent = texts[lang].tooLow;
    else result.textContent = texts[lang].tooHigh;
    result.textContent += "\n" + texts[lang].attemptsLeft(attempts);
  } else {
    // ðŸ”¹ Wenn Zufallsmodus aktiv ist, kein â€žzu hoch / zu niedrigâ€œ
    result.textContent = texts[lang].attemptsLeft(attempts);
  }

  if (attempts <= 0 && guess !== secret) {
    result.textContent = texts[lang].lose;
    guessBtn.disabled = true;
  }
};
</script>
</body>
</html>