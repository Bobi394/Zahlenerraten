<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>Hotspot Ratespiel ğŸ¦</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; background:#101820; color:#fff; text-align:center; padding:40px; }
input,button,a { padding:10px; border-radius:8px; margin:5px; width:220px; display:inline-block; text-decoration:none; color:inherit; }
.box { background:#1e293b; display:inline-block; padding:30px; border-radius:12px; }
#result { margin-top:15px; }
#reward { margin-top:12px; font-weight:bold; }
</style>
</head>
<body>
<div class="box">
<h1>ğŸ”¥ Hotspot Zahlenspiel ğŸ”¥</h1>
<p id="rangeInfo">Lade Bereichâ€¦</p>
<p id="info">Lade Einstellungenâ€¦</p>
<input id="guessInput" type="number" placeholder="Zahl eingeben">
<button id="guessBtn">Raten</button>
<p id="result"></p>
<p id="reward"></p>
<p id="hint"></p>
</div>

<script type="module">
const firebaseConfig = {
  apiKey: "AIzaSyBSDffrKz3_AE_iuwOLuZNB0yWLStMysSI",
  authDomain: "zahlenerraten.firebaseapp.com",
  databaseURL: "https://zahlenerraten-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "zahlenerraten",
  storageBucket: "zahlenerraten.firebasestorage.app",
  messagingSenderId: "143969932071",
  appId: "1:143969932071:web:850baabab3f9c0f2de0f02",
  measurementId: "G-KP89LYZJMT"
};

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, get, child, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const rangeInfo = document.getElementById("rangeInfo");
const info = document.getElementById("info");
const guessInput = document.getElementById("guessInput");
const guessBtn = document.getElementById("guessBtn");
const result = document.getElementById("result");
const reward = document.getElementById("reward");
const hint = document.getElementById("hint");

let attemptsLeft = 0;
let randomNumberMode = true;
let minNumber = 1;
let maxNumber = 50;
let lastReload = 0;
let password = "";
let link = "";

async function loadSettings(){
  const snapshot = await get(child(ref(db), "settings"));
  if(snapshot.exists()){
    const data = snapshot.val();
    attemptsLeft = data.maxAttempts || 6;
    randomNumberMode = data.randomNumber ?? true;
    minNumber = Number(data.minNumber) || 1;
    maxNumber = Number(data.maxNumber) || 50;
    password = data.password || "";
    link = data.link || "";
    info.textContent = `Du hast ${attemptsLeft} Versuche! ğŸ˜`;
    rangeInfo.textContent = `Errate eine Zahl zwischen ${minNumber} und ${maxNumber}`;
  }
}

await loadSettings();

// Reload
const reloadRef = ref(db,"reloadTrigger");
const sn = await get(reloadRef);
if(sn.exists()) lastReload = sn.val();
onValue(reloadRef,(snapshot)=>{
  if(snapshot.exists()){
    const val = snapshot.val();
    if(val!==lastReload){ lastReload=val; location.reload(); }
  }
});

// Raten
guessBtn.onclick = async ()=>{
  const guess = Number(guessInput.value);
  if(!Number.isFinite(guess)||guess<minNumber||guess>maxNumber){
    result.textContent=`âš ï¸ Gib eine Zahl zwischen ${minNumber} und ${maxNumber} ein!`;
    return;
  }

  let currentNumber;
  if(randomNumberMode){
    currentNumber = Math.floor(Math.random()*(maxNumber-minNumber+1))+minNumber;
  } else {
    const fSnap = await get(child(ref(db,"settings/fixedNumber")));
    currentNumber = fSnap.exists()? Number(fSnap.val()) : minNumber;
  }

  attemptsLeft--;

  if(guess===currentNumber){
    result.textContent="âœ… Richtig geraten!";
    guessBtn.disabled=true;
    guessInput.disabled=true;

    // Zeige Link, falls gesetzt, sonst Passwort
    if(link){
      reward.innerHTML = `ğŸ¯ Dein Link: <a href="${link}" target="_blank">${link}</a>`;
    } else {
      reward.textContent = `ğŸ”‘ Passwort: ${password}`;
    }
    return;
  }

  if(attemptsLeft<=0){
    result.textContent=`âŒ Keine Versuche mehr! Letzte Zahl war ${currentNumber}.`;
    guessBtn.disabled=true;
    guessInput.disabled=true;
    return;
  }

  hint.textContent = guess>currentNumber?"ğŸ“‰ Zu hoch!":"ğŸ“ˆ Zu niedrig!";
  info.textContent = `Noch ${attemptsLeft} Versuche`;
};
</script>
</body>
</html>